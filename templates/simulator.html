<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Симулятор ЯЭУ | ВВЭР</title>
    <style>
        /* Стили для вкладок и содержимого */
        .tab {
            display: inline-block;
            padding: 5px 10px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ccc;
            margin-right: 5px;
        }
        
        .tab.active {
            background-color: #fff;
            border-bottom: none;
        }

        .tab-content {
            display: none;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #fff;
        }

        .tab-content.active {
            display: flex;
        }

        /* Стили для рабочей области */
        .work-area {
            width: 100%;
            height: 60%;
            background-color: #28a745; /* зелёный цвет */
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            padding-bottom: 10%;
        }

        /* Ползунок */
        .slider-container {
            text-align: center;
            line-height: 10vh;
        }

        .slider {
            transform: rotate(-90deg); 
            width: 75px;
        }

        /* Модальное окно */
        .modal {
          display: none; /* Скрыто по умолчанию */
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5); /* Полупрозрачный фон */
          justify-content: center;
          align-items: center;
          animation: fadeIn 0.3s ease-in-out;
        }

        /* Контейнер для контента */
        .modal-content {
          background-color: white;
          padding: 20px;
          border-radius: 8px;
          text-align: center;
          min-width: 200px;
          max-width: 400px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Стиль текста */
        #alertMessage {
          font-size: 16px;
          margin-bottom: 20px;
          color: #333;
        }

        /* Стиль кнопки */
        #closeAlert {
          padding: 10px 20px;
          background-color: #007bff;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: 14px;
        }

        #closeAlert:hover {
          background-color: #0056b3;
        }

        /* Анимация появления */
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }


        /* Контейнер для контента */
        .error-content {
          background-color: red;
          padding: 20px;
          border-radius: 8px;
          text-align: center;
          min-width: 200px;
          max-width: 400px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Стиль текста */
        #errorMessage {
          font-size: 16px;
          margin-bottom: 20px;
          color: white;
        }

        #closeErrorAlert:hover {
          background-color: #0056b3;
        }

        /* Анимация появления */
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }

        /* жёлтый алерт */
        /* Контейнер для контента */
        .yellow-content {
          background-color: yellow;
          padding: 20px;
          border-radius: 8px;
          text-align: center;
          min-width: 200px;
          max-width: 400px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Стиль кнопки */
        #closeYellowAlert {
          padding: 10px 20px;
          background-color: green;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: 14px;
        }

        #closeYellowAlert:hover {
          background-color: #0056b3;
        }

        /* Анимация появления */
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }

        /* зелёный алерт */
        /* Контейнер для контента */
        .green-content {
          background-color: green;
          padding: 20px;
          border-radius: 8px;
          text-align: center;
          min-width: 200px;
          max-width: 400px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Стиль кнопки */
        #closeGreenAlert {
          padding: 10px 20px;
          background-color: yellow;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: 14px;
        }

        /* Стиль текста */
        #greenMessage {
          font-size: 16px;
          margin-bottom: 20px;
          color: white;
        }

        #closeGreenAlert:hover {
          background-color: #0056b3;
        }

        /* Анимация появления */
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
    </style>
</head>
<body>

<!-- Алерты -->
<div id="customAlert" class="modal">
  <div class="modal-content">
    <p id="alertMessage"></p>
    <button id="closeAlert">Понятно</button>
  </div>
</div>

<div id="errorAlert" class="modal">
  <div class="error-content">
    <p id="errorMessage"></p>
    <button id="closeErrorAlert">Принято</button>
  </div>
</div>

<div id="yellowAlert" class="modal">
  <div class="yellow-content">
    <p id="yellowMessage"></p>
    <button id="closeYellowAlert">Принято</button>
  </div>
</div>

<div id="greenAlert" class="modal">
  <div class="green-content">
    <p id="greenMessage"></p>
    <button id="closeGreenAlert">Принято</button>
  </div>
</div>

<!-- Рабочая область -->
<div class="work-area" id='three-container'>
    <!-- Рабочая область с графикой-->
</div>


<!-- Вкладки -->
<div class="tabs">
    <div class="tab active" data-tab="tab1">твэл</div>
    <div class="tab" data-tab="tab2">ТВС</div>
    <div class="tab" data-tab="tab3">Реактор</div>
    <div class="tab" data-tab="tab4">Парогенератор</div>
    <div class="tab" data-tab="tab5">Другая теплотехника</div>
    <div class="tab" data-tab="tab6">Системы безопасности</div>
    <div class="tab" data-tab="tab7">Радиационная безопасность</div>
    <div class="tab" data-tab="tab8">Эксплуатация</div>
</div>

<!-- Содержимое вкладок -->

<div id="tab1" class="tab-content active">
    <fieldset>
      <legend>Форма твэла</legend>
      <div style="display: flex;">
          <div>
            <div>
                <img src="static\interface\tvel_cyl.png" style="height: 100px;">
            </div>
            <input type="radio" id="cyl" name="tvel-form" value="cyl" checked />
            <label for="cyl">Цилиндрический</label>
          </div>
          <div>
            <div>
                <img src="static\interface\tvel_krest.png" style="height: 100px;">
            </div>   
            <input type="radio" id="cross" name="tvel-form" value="cross" />
            <label for="cross">Крестообразный</label>
          </div>
      </div>
    </fieldset>
    <fieldset>
        <legend>Обогащение</legend>
        <br>
        <div style="display: flex;">
            <div class='slider-container'>
                <input type="range" min="0.7" max="50" class="slider" id="slider" />
            </div>
            <div>
                50% <br> <br> 0,7% <br> (природное) 
            </div>
        </div>   
    </fieldset>
    <fieldset>
      <legend>Топливо</legend>
      <div>
        <input type="radio" id="metu" name="fuel" value="metu" checked />
        <label for="metu">Металлический уран</label>
      </div>

      <div>
        <input type="radio" id="uo2" name="fuel" value="uo2" />
        <label for="uo2">Диоксид урана</label>
      </div>

      <div>
        <input type="radio" id="th20" name="fuel" value="th20" />
        <label for="th20">Диоксид тория</label>
      </div>
    </fieldset>
    <fieldset>
      <legend>Полость для продуктов деления</legend>
      <div>
        <input type="radio" id="est" name="PD" value="est" checked />
        <label for="est">Есть</label>
      </div>
      <div>
        <input type="radio" id="net" name="PD" value="net" />
        <label for="net">Нет</label>
      </div>
    </fieldset>
    <fieldset>
      <legend>Материал оболочки</legend>
      <div>
        <input type="radio" id="zr" name="case" value="zr" checked />
        <label for="zr">Циркониевый сплав</label>
      </div>
      <div>
        <input type="radio" id="steel" name="case" value="steel" />
        <label for="steel">Сталь</label>
      </div>

      <div>
        <input type="radio" id="chugun" name="case" value="chugun" />
        <label for="chugun">Чугун</label>
      </div>
    </fieldset>
    <button id='loadTvel'>Построить</button>
</div>

<div id="tab2" class="tab-content">
    <fieldset>
      <legend>Тип решётки твэлов и твс</legend>
      <div style="display: flex;">
          <div>
            <div>
                <img src="static\interface\tvs_six.png" style="height: 100px;">
            </div>
            <input type="radio" id="six" name="tvs-form" value="six" checked />
            <label for="six">Шестигранная</label>
          </div>
          <div>
            <div>
                <img src="static\interface\tvs_square.png" style="height: 100px;">
            </div>   
            <input type="radio" id="square" name="tvs-form" value="square" />
            <label for="square">Квадратная</label>
          </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Замедлитель</legend>
      <div>
        <input type="radio" id="heavy" name="zamedl" value="heavy" checked />
        <label for="heavy">Тяжёлая вода</label>
      </div>

      <div>
        <input type="radio" id="water" name="zamedl" value="water" />
        <label for="water">Обычная вода</label>
      </div>

      <div>
        <input type="radio" id="grafit" name="zamedl" value="grafit" />
        <label for="grafit">Графит</label>
      </div>
    </fieldset>   

    <fieldset>
      <legend>Теплоноситель</legend>
      <div>
        <input type="radio" id="water_cooler" name="cooler" value="water_cooler" checked />
        <label for="water_cooler">Вода</label>
      </div>

      <div>
        <input type="radio" id="natruim" name="cooler" value="natruim" />
        <label for="natruim">Жидкий натрий</label>
      </div>

      <div>
        <input type="radio" id="lead" name="cooler" value="lead" />
        <label for="lead">Жидкий свинец</label>
      </div>
    </fieldset> 

    <fieldset>
      <legend>Дистанционирующие решётки</legend>
      <img src="static\interface\tvs_dr.png" style="height: 80px;">
      <div>
        <input type="radio" id="dist_yes" name="dist" value="dist_yes" checked />
        <label for="dist_yes">Есть</label>
      </div>

      <div>
        <input type="radio" id="dist_net" name="dist" value="dist_net" />
        <label for="dist_net">Нет</label>
      </div>
    </fieldset>

    <fieldset>
      <legend>Выгорающий поглотитель</legend>
      <div>
        <input type="radio" id="vyg_est" name="vygor" value="vyg_est" checked />
        <label for="vyg_est">Есть</label>
      </div>

      <div>
        <input type="radio" id="vyg_net" name="vygor" value="vyg_net" />
        <label for="vyg_net">Нет</label>
      </div>
    </fieldset> 

    <button id='tvsBtn'>Построить</button>
</div>

<div id="tab3" class="tab-content">
    <fieldset>
      <legend>Компоновка реакторной установки</legend>
      <div style="display: flex;">
          <div>
            <div>
                <img src="static\interface\komp_petl.png" style="height: 100px;">
            </div>
            <input type="radio" id="loop" name="reactor-form" value="loop" checked />
            <label for="loop">Петлевая</label>
          </div>
          <div>
            <div>
                <img src="static\interface\komp_block.png" style="height: 100px;">
            </div>   
            <input type="radio" id="block" name="reactor-form" value="block" />
            <label for="block">Блочная</label>
          </div>
          <div>
            <div>
                <img src="static\interface\komp_int.png" style="height: 100px;">
            </div>   
            <input type="radio" id="integral" name="reactor-form" value="integral" />
            <label for="integral">Интегральная</label>
          </div>
          <div>
            <div>
                <img src="static\interface\komp_kanal.png" style="height: 100px;">
            </div>   
            <input type="radio" id="kanal" name="reactor-form" value="kanal" />
            <label for="kanal">Канальная</label>
          </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Количество петель</legend>
      <form>
          <select name="count_loops">
            <option value="">-- Выберите количество --</option>
            <option value="0">Нет петель</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
          </select>
      </form>
    </fieldset>

    <fieldset>
      <legend>Антидебризные фильтры</legend>
      <img src="static\interface\tvs_adf.png" style="height: 80px;">
      <div>
        <input type="radio" id="deb_est" name="debrise" value="deb_est" checked />
        <label for="deb_est">Есть</label>
      </div>

      <div>
        <input type="radio" id="deb_net" name="debrise" value="deb_net" />
        <label for="deb_net">Нет</label>
      </div>
    </fieldset> 

    <button id='reactorBtn'>Построить</button>

</div>

<div id="tab4" class="tab-content">
    <fieldset>
      <legend>Тип поверхности теплообмена (трубочек)</legend>
      <div style="display: flex;">
          <div>
            <div>
                <img src="static\interface\tube_u.png" style="height: 100px;">
            </div>
            <input type="radio" id="u_obraz" name="tube-form" value="u_obraz" checked />
            <label for="u_obraz">U-образные трубы</label>
          </div>
          <div>
            <div>
                <img src="static\interface\tube_straight.png" style="height: 100px;">
            </div>   
            <input type="radio" id="straight" name="tube-form" value="straight" />
            <label for="straight">Прямые трубы</label>
          </div>
          <div>
            <div>
                <img src="static\interface\tube_zmeev_2.png" style="height: 100px;">
            </div>   
            <input type="radio" id="zmeev" name="tube-form" value="zmeev" />
            <label for="zmeev">Змеевики</label>
          </div>
          <!-- <div>
            <div>
                <img src="static\interface\tube_fild.png" style="height: 100px;">
            </div>   
            <input type="radio" id="fild" name="tube-form" value="fild" />
            <label for="fild">Трубки Фильда</label>
          </div> -->
      </div>
    </fieldset>

    <!-- <fieldset>
      <legend>Наличие парогенератора</legend>
      <div>
        <input type="radio" id="pg_yes" name="is_pg" value="pg_yes" checked />
        <label for="pg_yes">Есть</label>
      </div>

      <div>
        <input type="radio" id="pg_no" name="is_pg" value="pg_no" />
        <label for="pg_no">Нет</label>
      </div>
    </fieldset>  -->

    <fieldset>
      <legend>Наличие дистанционирующих решёток</legend>
      <div>
        <input type="radio" id="pg_dist_yes" name="is_pg_dist" value="pg_dist_yes" checked />
        <label for="pg_dist_yes">Есть</label>
      </div>

      <div>
        <input type="radio" id="pg_dist_no" name="is_pg_dist" value="pg_dist_no" />
        <label for="pg_dist_no">Нет</label>
      </div>
    </fieldset> 

    <button id='pgBtn'>Построить</button>
</div>

<div id="tab5" class="tab-content">
    <div>
        <div>
            <img src="static\interface\tepl_gzn.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="tepl_gzn" name="teplo" value="tepl_gzn" />
        <label for="tepl_gzn">ГЦН</label>
    </div>
    <div>
        <div>
            <img src="static\interface\tepl_nasos.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="tepl_nasos" name="teplo2" value="tepl_nasos" />
        <label for="tepl_nasos">Питательный насос</label>
    </div>
    <div>
        <div>
            <img src="static\interface\tepl_elmag.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="tepl_elmag" name="teplo3" value="tepl_elmag" />
        <label for="tepl_elmag">Электромагнитный насос</label>
    </div>
    <div>
        <div>
            <img src="static\interface\tepl_turbine.png" style="height: 100px; padding-right: 10px;">
        </div>   
        <input type="checkbox" id="tepl_turbine" name="teplo4" value="tepl_turbine" />
        <label for="tepl_turbine">Турбина</label>
    </div>
    <div>
        <div>
            <img src="static\interface\tepl_cond.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="tepl_cond" name="teplo5" value="tepl_cond" />
        <label for="tepl_cond">Конденсатор</label>
    </div>
    <!-- <div>
        <div>
            <img src="static\interface\tepl_dear.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="tepl_dear" name="teplo" value="tepl_dear" />
        <label for="tepl_dear">Деаэратор</label>
    </div> -->
    <button id="btnTeplo">Построить</button>
</div>

<div id="tab6" class="tab-content">
    <div>
        <div>
            <img src="static\interface\sb_germo.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="sb_germo" name="sb_1" value="sb_germo" />
        <label for="sb_germo">Гермооболочка</label>
    </div>
    <div>
        <div>
            <img src="static\interface\sb_suz.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="sb_suz" name="sb_2" value="sb_suz" />
        <label for="sb_suz">Стержни СУЗ и АЗ</label>
    </div>
    <div>
        <div>
            <img src="static\interface\sb_ge.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="sb_ge" name="sb_3" value="sb_ge" />
        <label for="sb_ge">Гидроёмкости охлаждения</label>
    </div>
    <div>
        <div>
            <img src="static\interface\sb_trap.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="sb_trap" name="sb_4" value="sb_trap" />
        <label for="sb_trap">Ловушка расплава</label>
    </div>
    <div>
        <div>
            <img src="static\interface\sb_sprink.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="sb_sprink" name="sb_5" value="sb_sprink" />
        <label for="sb_sprink">Спринклерная система</label>
    </div>
    <div>
        <div>
            <img src="static\interface\sb_sliv.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="sb_sliv" name="sb_6" value="sb_sliv" />
        <label for="sb_sliv">Слив воды</label>
    </div>
    <button id="btnSB">Построить</button>
</div>

<div id="tab7" class="tab-content">
    <div>
        <div>
            <img src="static\interface\rb_conc.png" style="height: 100px;">
        </div>   
        <input type="radio" id="rb_conc" name="rb" value="rb_conc" />
        <label for="rb_conc">Бетон</label>
    </div>
    <!-- <div>
        <div>
            <img src="static\interface\rb_zhvz.png" style="height: 100px;">
        </div>   
        <input type="checkbox" id="rb_zhvz" name="rb" value="rb_zhvz" />
        <label for="rb_zhvz">Железо-водная защита</label>
    </div> -->
    <div>
        <div>
            <img src="static\interface\rb_lead.png" style="height: 100px;">
        </div>   
        <input type="radio" id="rb_lead" name="rb" value="rb_lead" />
        <label for="rb_lead">Свинец</label>
    </div>
    <div>
        <div>
            <img src="static\interface\rb_wood.png" style="height: 100px;">
        </div>   
        <input type="radio" id="rb_wood" name="rb" value="rb_wood" />
        <label for="rb_wood">Дерево</label>
    </div>
    <div>
        <div>
            <img src="static\interface\rb_sand.png" style="height: 100px;">
        </div>   
        <input type="radio" id="rb_sand" name="rb" value="rb_sand" />
        <label for="rb_sand">Песок</label>
    </div>
    <button id="btnRadBez">Построить</button>
</div>

<div id="tab8" class="tab-content">
    <fieldset>
        <legend>Управление</legend>
        <button id="Start">Пуск</button>
        <button id="Stop">Останов</button>
        <button id="test">Тест</button>
    </fieldset>
    <fieldset>
        <legend>Небольшие инциденты</legend>
        <button id="debrise">Посторонние предметы в контуре</button>
        <button>Коррозия</button>
    </fieldset>
    <fieldset>
        <legend>Серьёзные происшествия</legend>
        <button>Отключение электроэнергии</button>
        <button>Цунами + Землетрясение</button>
        <!-- <button>Падение самолёта</button> -->
        <button>Отказ насоса (ГЦН)</button>
    </fieldset>
</div>

<!-- JavaScript для переключения вкладок -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', function () {
                // Убираем активность у всех вкладок и контента
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(tc => tc.classList.remove('active'));

                // Делаем активной выбранную вкладку и её содержимое
                tab.classList.add('active');
                const contentId = tab.getAttribute('data-tab');
                document.getElementById(contentId).classList.add('active');
            });
        });
    });
</script>

</body>
</html>
<!-- Подключаем библиотеки алертов -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.all.min.js"></script>
<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/sweetalert2@7.12.15/dist/sweetalert2.min.css'>
<script>
// Функция для отображения кастомного alert
function explainTask(message) {
  const modal = document.getElementById('customAlert');
  const alertMessage = document.getElementById('alertMessage');
  const closeButton = document.getElementById('closeAlert');

  // Устанавливаем сообщение
  alertMessage.textContent = message;

  // Показываем модальное окно
  modal.style.display = 'flex';

  // Закрываем модальное окно при нажатии на кнопку
  closeButton.onclick = function() {
    modal.style.display = 'none';
  };

  // Закрываем модальное окно, если нажать на фон
  modal.onclick = function(e) {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  };
}

function errorAlert(message) {
  const modal = document.getElementById('errorAlert');
  const alertMessage = document.getElementById('errorMessage');
  const closeButton = document.getElementById('closeErrorAlert');

  // Устанавливаем сообщение
  alertMessage.textContent = message;

  // Показываем модальное окно
  modal.style.display = 'flex';

  // Закрываем модальное окно при нажатии на кнопку
  closeButton.onclick = function() {
    modal.style.display = 'none';
  };

  // Закрываем модальное окно, если нажать на фон
  modal.onclick = function(e) {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  };
}

function yellowAlert(message) {
  const modal = document.getElementById('yellowAlert');
  const alertMessage = document.getElementById('yellowMessage');
  const closeButton = document.getElementById('closeYellowAlert');

  // Устанавливаем сообщение
  alertMessage.textContent = message;

  // Показываем модальное окно
  modal.style.display = 'flex';

  // Закрываем модальное окно при нажатии на кнопку
  closeButton.onclick = function() {
    modal.style.display = 'none';
  };

  // Закрываем модальное окно, если нажать на фон
  modal.onclick = function(e) {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  };
}

function greenAlert(message) {
  const modal = document.getElementById('greenAlert');
  const alertMessage = document.getElementById('greenMessage');
  const closeButton = document.getElementById('closeGreenAlert');

  // Устанавливаем сообщение
  alertMessage.textContent = message;

  // Показываем модальное окно
  modal.style.display = 'flex';

  // Закрываем модальное окно при нажатии на кнопку
  closeButton.onclick = function() {
    modal.style.display = 'none';
  };

  // Закрываем модальное окно, если нажать на фон
  modal.onclick = function(e) {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  };
}

// Вызов кастомного alert
explainTask('Вы выбрали современный путь (без обучающих подсказок). Вы должны сконструировать АЭС большой мощности, обладающую максимальной безопасностью и экономической эффективностью. В вашей стране есть залежи урана.');
</script>

<!-- Графика и логика симулятора -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// Основная функция
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, 600 / 400, 0.1, 1000);
// camera.position.z = 5;
const renderer = new THREE.WebGLRenderer();
renderer.setSize(1400, 450);
renderer.setClearColor(0xffffff);
document.getElementById('three-container').appendChild(renderer.domElement);

// Константы для координат
const xCoord = -5;
const yCoord = 0;
const zCoord = 0;

const tvs_xCoord = -4;
const tvs_yCoord = 0;

const reactor_xCoord = -2;
const reactor_yCoord = 0;

const pg_xCoord = 1;
const pg_yCoord = 0;

// let isTvel = false;
// let isTvs = false;
// let isReactor = false;
// let isPG = false;
// let isTeplo = false;
// let isSB = false;
// let isRadBez = false;

class AesStatusSystem {
    constructor() {
        // поля для конструирования
        this.isTvel = false;
        this.isTvs = false;
        this.isReactor = false;
        this.isPG = false;
        this.isTeplo = false;
        this.isSB = false;
        this.isRadBez = false;

        // поля для эксплуатации
        // this.isWorking = false;
        // this.isADF = false;
    }

  activateSystem(systemName) {
    if (this.hasOwnProperty(systemName)) {
      this[systemName] = true;
    } else {
      console.warn(`Системы ${systemName} не существует!`);
    }
  }

  isTvsTurn() {
      return this.isTvel && !this.isTvs;
  }

  isReactorTurn() {
      return this.isTvel && this.isTvs && !this.isReactor;
  }

  isPGTurn() {
      return this.isTvel && this.isTvs && this.isReactor && !this.isPG;
  }

  isTeploTurn() {
      return this.isTvel && this.isTvs && this.isReactor && this.isPG && !this.isTeplo;
  }

  isSBTurn() {
      return this.isTvel && this.isTvs && this.isReactor && this.isPG && this.isTeplo && !this.isSB;
  }

  isRadBezTurn() {
      return this.isTvel && this.isTvs && this.isReactor && this.isPG && this.isTeplo && this.isSB && !this.isRadBez;
  }

  isReadyToWork() {
        return this.isTvel && this.isTvs && this.isReactor && this.isPG && this.isTeplo && this.isSB && this.isRadBez;
  }
}

class AesDynamicData {
  constructor() {
    // Добавляем метод setProperties в сам объект (не в Proxy)
    this.setProperties = (...args) => {
      if (args.length % 2 !== 0) {
        throw new Error("Нечетное количество аргументов. Ожидаются пары ключ-значение");
      }

      for (let i = 0; i < args.length; i += 2) {
        const key = args[i];
        const value = args[i + 1];
        this[key] = value;
      }
    };

    // Proxy для автоматического создания вложенных объектов
    return new Proxy(this, {
      get(target, prop) {
        // Пропускаем служебные свойства и методы
        if (prop in target || typeof prop === 'symbol') {
          return target[prop];
        }

        if (!target[prop]) {
          target[prop] = new AesDynamicData();
        }
        return target[prop];
      }
    });
  }

    isADF() {
      return aesData.reactor.adf == 'deb_est';
    }
}

class ElementGeometry {
    constructor(x, y, w, h) {
        this.x = x;
        this.y = y;
        this.width = w;
        this.height = h;
    }
}


let aesStatus = new AesStatusSystem();
let aesData = new AesDynamicData();

// задаём геометрию элементов
const reactorGeo = new ElementGeometry(reactor_xCoord, reactor_yCoord, 0.75, 4);
const peregruzGeo = new ElementGeometry(reactor_xCoord, reactor_yCoord + 1.5, 1.4, 1);


// Функция отрисовки твэла
function loadTvel() {
    if (!aesStatus.isTvel) {
        // Загружаем текстуру (картинку)
        const textureLoader = new THREE.TextureLoader();
        const selectedValue = document.querySelector('input[name="tvel-form"]:checked').value;
        let texture = textureLoader.load('static/vver/tvel_cyl.png');  // Укажите путь к вашему изображению
        if (selectedValue=='cyl') {
            texture = textureLoader.load('static/vver/tvel_cyl.png');
        }
        else {
            texture = textureLoader.load('static/vver/tvel_krest.png');
        }
        const fuel = document.querySelector('input[name="fuel"]:checked').value;
        // const pd = document.querySelector('input[name="PD"]:checked').value;
        // const case = document.querySelector('input[name="case"]:checked').value;
        // const percentage = document.querySelector('input[class="slider"]:checked').value;
        const percentage = document.getElementById('slider').value;
        if ((fuel=='metu' || fuel=='uo2')  && (percentage>4 && percentage<20)) {
            // Создаем плоскость, на которую наложим текстуру
            const geometry = new THREE.PlaneGeometry(0.3, 5);  // Размер плоскости
            const material = new THREE.MeshBasicMaterial({ map: texture });
            const plane = new THREE.Mesh(geometry, material);

            // Устанавливаем позицию изображения на заданные координаты
            plane.position.set(xCoord, yCoord, zCoord);

            // Добавляем плоскость в сцену
            scene.add(plane);

            // Камера
            camera.position.z = 5;

            // Функция анимации для рендеринга
            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }
            animate();

            aesStatus.activateSystem('isTvel');
            // Задаем свойства для твэла через метод
            aesData.tvel.setProperties(
                'form', document.querySelector('input[name="tvel-form"]:checked').value,
                'obogashenie', document.getElementById('slider').value,
                'polostPD', document.querySelector('input[name="PD"]:checked').value,
                'materialObolochki', document.querySelector('input[name="case"]:checked').value
            );
            console.log(
                'Сконструирован твэл:',
                aesData.tvel.form,
                aesData.tvel.obogashenie,
                aesData.tvel.polostPD,
                aesData.tvel.materialObolochki
            )
        } else {
            errorAlert('Ваш твэл не соответствует пути. Возможно, ваше обогащение не соответствует нормам МАГАТЭ для гражданской техники. Или вы выбрали топливо, которого нет в вашей стране.');
            // yellowAlert('Test')
            // greenAlert('Test green')
        }
    }
    else {
        errorAlert('Твэл уже сконструирован.')
    }
}

function printTVS() {
    if (aesStatus.isTvsTurn()) {
        // Загружаем текстуру (картинку)
        const textureLoader = new THREE.TextureLoader();
        const selectedValue = document.querySelector('input[name="tvs-form"]:checked').value;
        let texture = textureLoader.load('static/vver/tvs_six.png');  // Укажите путь к вашему изображению
        if (selectedValue=='six') {
            texture = textureLoader.load('static/vver/tvs_six.png');
        }
        else {
            texture = textureLoader.load('static/vver/tvs_square.png');
        }
        const zamedl = document.querySelector('input[name="zamedl"]:checked').value;
        const cooler = document.querySelector('input[name="cooler"]:checked').value;
        const dist = document.querySelector('input[name="dist"]:checked').value;

        if (zamedl=='water' && cooler=='water_cooler' && dist=='dist_yes') {
        // Создаем плоскость, на которую наложим текстуру
          const geometry = new THREE.PlaneGeometry(0.3, 5);
          const material = new THREE.MeshBasicMaterial({ map: texture });
          const plane = new THREE.Mesh(geometry, material);

          // Устанавливаем позицию изображения на заданные координаты
          plane.position.set(tvs_xCoord, tvs_yCoord, zCoord);

          // Добавляем плоскость в сцену
          scene.add(plane);

          // Камера
          camera.position.z = 5;

          // Функция анимации для рендеринга
          function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
          }
          animate();

            aesStatus.activateSystem('isTvs')
            aesData.tvs.setProperties(
                'form', document.querySelector('input[name="tvs-form"]:checked').value,
                'zamedlitel', document.querySelector('input[name="zamedl"]:checked').value,
                'coolant', document.querySelector('input[name="cooler"]:checked').value,
                'dr', document.querySelector('input[name="dist"]:checked').value,
                'vp', document.querySelector('input[name="vygor"]:checked').value
            );
            console.log(
                'Сконструирована ТВС:',
                aesData.tvs.form,
                aesData.tvs.zamedlitel,
                aesData.tvs.coolant,
                aesData.tvs.dr,
                aesData.tvs.vp
            )

            // удаляем твэл
            printElement(0.3, 5, xCoord, yCoord, '/static/vver/white.webp')
        }
        else {
            errorAlert('Ваша ТВС несовместима с выбранным путём. Возможно, вы выбрали неправильный замедлитель, теплоноситель или отсутсвуют дистанционирующие решётки.')
        }
    }
    else {
        errorAlert('Сейчас не время конструировать ТВС. Либо вы ещё не сделали твэл, либо ТВС уже есть.')
    }
}

function printReactor(repeat=false) {
    if (aesStatus.isReactorTurn() || repeat == true) {
        // Загружаем текстуру (картинку)
        const textureLoader = new THREE.TextureLoader();
        const selectedValue = document.querySelector('input[name="reactor-form"]:checked').value;
        // const count_loops = document.querySelector('input[name="reactor-form"]:checked').value;
        const count_loops = document.querySelector('select[name="count_loops"]').value;
        let texture = textureLoader.load('static/vver/reactor_vver.jpg');  // Укажите путь к вашему изображению
        if (selectedValue == 'loop' && count_loops > 2) {
            // Создаем плоскость, на которую наложим текстуру
            const geometry = new THREE.PlaneGeometry(0.75, 4);  // Размер плоскости
            const material = new THREE.MeshBasicMaterial({map: texture});
            const plane = new THREE.Mesh(geometry, material);

            // Устанавливаем позицию изображения на заданные координаты
            plane.position.set(reactor_xCoord, reactor_yCoord, zCoord);

            // Добавляем плоскость в сцену
            scene.add(plane);

            // Камера
            camera.position.z = 5;

            //рисуем трубопровод
            const pipe_material = new THREE.LineBasicMaterial(
                {
                    color: 0x1a1a1a,
                    linewidth: 50,
                    linecap: 'round'
                });

            const points = [];
            points.push(new THREE.Vector3(-1.75, 0, 0));
            points.push(new THREE.Vector3(-1, 0, 0));
            points.push(new THREE.Vector3(-1, 1, 0));
            points.push(new THREE.Vector3(1, 1, 0));
            points.push(new THREE.Vector3(1, -1.5, 0));
            points.push(new THREE.Vector3(-1, -1.5, 0));
            points.push(new THREE.Vector3(-1, -0.4, 0));
            points.push(new THREE.Vector3(-1.75, -0.4, 0));

            const pipe_geometry = new THREE.BufferGeometry().setFromPoints(points);

            const pipe = new THREE.Line(pipe_geometry, pipe_material);

            scene.add(pipe);
            renderer.render(scene, camera);

            // Функция анимации для рендеринга
            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }

            animate();

            if (!repeat) {
                aesStatus.activateSystem('isReactor');
                aesData.reactor.setProperties(
                    'form', document.querySelector('input[name="reactor-form"]:checked').value,
                    'loops', document.querySelector('select[name="count_loops"]').value,
                    'adf', document.querySelector('input[name="debrise"]:checked').value
                );
                console.log(
                    'Сконструирован реактор:',
                    aesData.reactor.form,
                    aesData.reactor.loops,
                    aesData.reactor.adf
                )
                // стираем твс
                printElement(0.3, 5, tvs_xCoord, tvs_yCoord, '/static/vver/white.webp')
            }

        } else {
            errorAlert("Вы выбрали неправильную компоновку или количество петель.")
        }
    } else {
        errorAlert('Сейчас не время конструировать реактор. Возможно, он уже сконструирован. Или нет его внутренностей (твэл, твс).')
    }
}

function printPG() {
    if (aesStatus.isPGTurn()) {
        // Загружаем текстуру (картинку)
        const textureLoader = new THREE.TextureLoader();
        const is_pg_dist = document.querySelector('input[name="is_pg_dist"]:checked').value;
        let texture = textureLoader.load('static/vver/pg_vver.png');  // Укажите путь к вашему изображению
        if (is_pg_dist=='pg_dist_yes') {

          // Создаем плоскость, на которую наложим текстуру
          const geometry = new THREE.PlaneGeometry(1.5, 1.2);  // Размер плоскости
          const material = new THREE.MeshBasicMaterial({ map: texture });
          const plane = new THREE.Mesh(geometry, material);

          // Устанавливаем позицию изображения на заданные координаты
          plane.position.set(pg_xCoord, pg_yCoord, zCoord);

          // Добавляем плоскость в сцену
          scene.add(plane);

          // Камера
          camera.position.z = 5;

          //рисуем трубопровод
            const pipe_material = new THREE.LineBasicMaterial(
                { color: 0x1a1a1a,
                  linewidth: 10,
                  linecap: 'round'
                } );

            const points = [];

            points.push( new THREE.Vector3( 1.5, 0.6, 0 ) );
            points.push( new THREE.Vector3( 1.5, 1, 0 ) );
            points.push( new THREE.Vector3( 4, 1, 0 ) );
            points.push( new THREE.Vector3( 4, -2, 0 ) );
            points.push( new THREE.Vector3( 1.5, -2, 0 ) );
            points.push( new THREE.Vector3( 1.5, -0.5, 0 ) );


            const pipe_geometry = new THREE.BufferGeometry().setFromPoints( points );

            const pipe = new THREE.Line( pipe_geometry, pipe_material );

            scene.add(pipe);
            renderer.render( scene, camera );

          // Функция анимации для рендеринга
          function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
          }
          animate();

          aesStatus.activateSystem('isPG');

          aesData.steamGenerator.setProperties(
                'form', document.querySelector('input[name="tube-form"]:checked').value,
                'dr', document.querySelector('input[name="is_pg_dist"]:checked').value
          );
          console.log(
              'Сконструирован парогенератор:',
              aesData.steamGenerator.form,
              aesData.steamGenerator.dr
          )
        }
        else {
            errorAlert('Не хватает дистанционирующих решёток для трубочек парогенератора.')
        }
    } else {
        errorAlert('Сейчас не время конструировать парогенератор. Либо он уже есть, либо не хватает чего-то из I контура (твэл, твс, реактор).')
    }

}

function printGZN() {
  // Загружаем текстуру (картинку)
  const textureLoader = new THREE.TextureLoader();
  const is_gzn = document.querySelector('input[name="teplo"]:checked').value;
  let texture = textureLoader.load('static/vver/gzn.png');  // Укажите путь к вашему изображению 
  if (is_gzn=='tepl_gzn') {

      // Создаем плоскость, на которую наложим текстуру
      const geometry = new THREE.PlaneGeometry(0.3, 1.2);  // Размер плоскости
      const material = new THREE.MeshBasicMaterial({ map: texture });
      const plane = new THREE.Mesh(geometry, material);

      // Устанавливаем позицию изображения на заданные координаты
      plane.position.set(0, -1.5, zCoord);

      // Добавляем плоскость в сцену
      scene.add(plane);

      // Камера
      camera.position.z = 5;

      renderer.render( scene, camera );

      // Функция анимации для рендеринга
      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
      animate();
  }
}

// function printPitNasos() {
//   // Загружаем текстуру (картинку)
//   const textureLoader = new THREE.TextureLoader();
//   const is_pit_nasos = document.querySelector('input[name="teplo2"]:checked').value;
//   let texture = textureLoader.load('static/vver/pit_nasos.jpg');  // Укажите путь к вашему изображению
//   if (is_pit_nasos=='tepl_nasos') {
//
//       // Создаем плоскость, на которую наложим текстуру
//       const geometry = new THREE.PlaneGeometry(1, 1);  // Размер плоскости
//       const material = new THREE.MeshBasicMaterial({ map: texture });
//       const plane = new THREE.Mesh(geometry, material);
//
//       // Устанавливаем позицию изображения на заданные координаты
//       plane.position.set(3, -2, zCoord);
//
//       // Добавляем плоскость в сцену
//       scene.add(plane);
//
//       // Камера
//       camera.position.z = 5;
//
//       renderer.render( scene, camera );
//
//       // Функция анимации для рендеринга
//       function animate() {
//         requestAnimationFrame(animate);
//         renderer.render(scene, camera);
//       }
//       animate();
//   }
// }

function printPitNasos() {
  // Загружаем текстуру (картинку)
  const textureLoader = new THREE.TextureLoader();
  const is_pit_nasos = document.querySelector('input[name="teplo2"]:checked').value;
  let texture = textureLoader.load('static/vver/pit_nasos.jpg');  // Укажите путь к вашему изображению 
  if (is_pit_nasos=='tepl_nasos') {

      // Создаем плоскость, на которую наложим текстуру
      const geometry = new THREE.PlaneGeometry(1, 1);  // Размер плоскости
      const material = new THREE.MeshBasicMaterial({ map: texture });
      const plane = new THREE.Mesh(geometry, material);

      // Устанавливаем позицию изображения на заданные координаты
      plane.position.set(2, -2, zCoord);

      // Добавляем плоскость в сцену
      scene.add(plane);

      // Камера
      camera.position.z = 5;

      renderer.render( scene, camera );

      // Функция анимации для рендеринга
      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
      animate();
  }
}

function printTurbine() {
  // Загружаем текстуру (картинку)
  const textureLoader = new THREE.TextureLoader();
  const is_turbine = document.querySelector('input[name="teplo4"]:checked').value;
  let texture = textureLoader.load('static/vver/turbine.jpg');  // Укажите путь к вашему изображению 
  if (is_turbine=='tepl_turbine') {

      // Создаем плоскость, на которую наложим текстуру
      const geometry = new THREE.PlaneGeometry(1, 1);  // Размер плоскости
      const material = new THREE.MeshBasicMaterial({ map: texture });
      const plane = new THREE.Mesh(geometry, material);

      // Устанавливаем позицию изображения на заданные координаты
      plane.position.set(4, 0, zCoord);

      // Добавляем плоскость в сцену
      scene.add(plane);

      // Камера
      camera.position.z = 5;

      renderer.render( scene, camera );

      // Функция анимации для рендеринга
      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
      animate();
  }
}

function printCondensator() {
  // Загружаем текстуру (картинку)
  const textureLoader = new THREE.TextureLoader();
  const is_condensator = document.querySelector('input[name="teplo5"]:checked').value;
  let texture = textureLoader.load('static/vver/condensator.png');  // Укажите путь к вашему изображению 
  if (is_condensator=='tepl_cond') {

      // Создаем плоскость, на которую наложим текстуру
      const geometry = new THREE.PlaneGeometry(1, 1);  // Размер плоскости
      const material = new THREE.MeshBasicMaterial({ map: texture });
      const plane = new THREE.Mesh(geometry, material);

      // Устанавливаем позицию изображения на заданные координаты
      plane.position.set(4, -2, zCoord);

      // Добавляем плоскость в сцену
      scene.add(plane);

      // Камера
      camera.position.z = 5;

      renderer.render( scene, camera );

      // Функция анимации для рендеринга
      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
      animate();
  }
}

function printRadBez() {
    if (aesStatus.isRadBezTurn()) {
        let material = document.querySelector('input[name="rb"]:checked').value;
        // let is_beton = 0;
        // try {
        //     is_beton = document.querySelector('input[name="rb1"]:checked').value;
        // }
        // catch(exceptionVar) {
        //     is_beton = 0;
        // }
        //
        // let is_lead = 0;
        // try {
        //     is_lead = document.querySelector('input[name="rb2"]:checked').value;
        // }
        // catch(exceptionVar) {
        //     is_lead = 0;
        // }
        //
        // let is_wood = 0;
        // try {
        //     is_wood = document.querySelector('input[name="rb3"]:checked').value;
        // }
        // catch(exceptionVar) {
        //     is_wood = 0;
        // }
        //
        // let is_sand = 0;
        // try {
        //     is_sand = document.querySelector('input[name="rb4"]:checked').value;
        // }
        // catch(exceptionVar) {
        //     is_sand = 0;
        // }

        const textureLoader = new THREE.TextureLoader();
        let texture = textureLoader.load('static/vver/beton.png');
        if (material == 'rb_conc') {
            texture = textureLoader.load('static/vver/beton.png');
        }
        if (material == 'rb_lead') {
            texture = textureLoader.load('static/vver/lead.webp');
        }
        // console.log(is_beton, is_lead, is_wood, is_sand);
        if (
            // (is_beton == 'rb_conc' || is_lead == 'rb_lead') && (is_wood == 0 && is_sand == 0)
            material == 'rb_conc' || material == 'rb_lead'
        ) {

            // Создаем плоскость, на которую наложим текстуру
            const geometry = new THREE.PlaneGeometry(0.25, 1.5);  // Размер плоскости
            const material = new THREE.MeshBasicMaterial({ map: texture });
            const plane = new THREE.Mesh(geometry, material);
            const plane2 = new THREE.Mesh(geometry, material);

            // Устанавливаем позицию изображения на заданные координаты
            plane.position.set(-1.5, -1.25, zCoord);
            plane2.position.set(-2.6, -1.25, zCoord);

            // Добавляем плоскость в сцену
            scene.add(plane);
            scene.add(plane2);

            // Камера
            camera.position.z = 5;

            renderer.render( scene, camera );

            // Функция анимации для рендеринга
            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }
            animate();
            // isRadBez = true;
            aesStatus.activateSystem('isRadBez');
            aesData.rb.setProperties(
                'material', document.querySelector('input[name="rb"]:checked').value
            );
            console.log(
                'Спроектирована биологическая защита:', aesData.rb.material
            )
        }
        else {
            errorAlert('Выбран неправильный материал для биологической защиты. Персонал АЭС откажется работать.')
        }
    } else {
        errorAlert('Сейчас не время проектировать биологическую защиту. Её нужно строить в последнюю очередь перед эксплуатацией. Или она уже есть.')
    }
}

function sleep(milliseconds) {
  const start = Date.now();
  while (Date.now() - start < milliseconds) {
    // Просто ждем, пока не пройдет нужное количество времени
  }
}

function animateTurbine() {
  while (true) {
      console.log('запущен цикл while')
      // Загружаем текстуру (картинку)
      const textureLoader = new THREE.TextureLoader();
      const is_turbine = document.querySelector('input[name="teplo4"]:checked').value;
      for (let i = 203; i <= 289; i++) {
          let texture = textureLoader.load(`static/turbine frames/Анимация турбины_${i}.jpg`);
          if (is_turbine=='tepl_turbine') {
              console.log('запущен цикл for')
              sleep(500);
              // Создаем плоскость, на которую наложим текстуру
              const geometry = new THREE.PlaneGeometry(1, 1);  // Размер плоскости
              const material = new THREE.MeshBasicMaterial({ map: texture });
              const plane = new THREE.Mesh(geometry, material);

              // Устанавливаем позицию изображения на заданные координаты
              plane.position.set(0, 0, zCoord);

              // Добавляем плоскость в сцену
              scene.add(plane);

              // Камера
              camera.position.z = 5;

              renderer.render( scene, camera );

              // Функция анимации для рендеринга
              function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
              }
              animate();
          }
      }
  }
}

function testTurbine() {
    // Загружаем текстуру (картинку)
  const textureLoader = new THREE.TextureLoader();
  const is_turbine = document.querySelector('input[name="teplo4"]:checked').value;
  while (true) {
      console.log('запущен цикл while')
      for (let i = 203; i <= 289; i++) {
          sleep(500);
          console.log('запущен цикл for')
          let texture = textureLoader.load('static/turbine frames/Анимация турбины_203.jpg');  // Укажите путь к вашему изображению
          if (is_turbine=='tepl_turbine') {

              // Создаем плоскость, на которую наложим текстуру
              const geometry = new THREE.PlaneGeometry(1, 1);  // Размер плоскости
              const material = new THREE.MeshBasicMaterial({ map: texture });
              const plane = new THREE.Mesh(geometry, material);

              // Устанавливаем позицию изображения на заданные координаты
              plane.position.set(4, 0, zCoord);

              // Добавляем плоскость в сцену
              scene.add(plane);

              // Камера
              camera.position.z = 5;

              renderer.render( scene, camera );

              // Функция анимации для рендеринга
              function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
              }
              animate();
          }
      }
  }
}

function testTurbine2() {
    const textureLoader = new THREE.TextureLoader();
    const is_turbine = document.querySelector('input[name="teplo4"]:checked').value;

    // Массив для хранения текстур
    const textures = [];

    // Загружаем текстуры заранее
    for (let i = 203; i <= 289; i++) {
      const texture = textureLoader.load(`static/turbine frames/Анимация турбины_${i}.jpg`);
      textures.push(texture);
    }

    // Создаем плоскость для отображения текстуры
    const geometry = new THREE.PlaneGeometry(1, 1);
    const material = new THREE.MeshBasicMaterial({ map: textures[0] }); // Начинаем с первой текстуры
    const plane = new THREE.Mesh(geometry, material);
    plane.position.set(4, 0, zCoord); // Устанавливаем позицию
    scene.add(plane);

    // Индекс текущей текстуры
    let currentTextureIndex = 0;

    // Функция анимации
    function animate() {
      requestAnimationFrame(animate);

      // Обновляем текстуру каждые 500 мс
      if (is_turbine === 'tepl_turbine') {
        sleep(500);
        currentTextureIndex = (currentTextureIndex + 1) % textures.length; // Переходим к следующей текстуре
        material.map = textures[currentTextureIndex]; // Применяем новую текстуру
        material.needsUpdate = true; // Указываем, что материал нужно обновить
        console.log(`здесь обновляется текстура ${currentTextureIndex}`)
      }

      renderer.render(scene, camera);
    }

    // Запускаем анимацию
    animate();
}

function testTurbine3(i){
    const textureLoader = new THREE.TextureLoader();
  const is_turbine = document.querySelector('input[name="teplo4"]:checked').value;
  let texture = textureLoader.load(`static/turbine frames/Анимация турбины_${i}.jpg`);  // Укажите путь к вашему изображению
  if (is_turbine=='tepl_turbine') {
      // Создаем плоскость, на которую наложим текстуру
      const geometry = new THREE.PlaneGeometry(1, 1);  // Размер плоскости
      const material = new THREE.MeshBasicMaterial({ map: texture });
      const plane = new THREE.Mesh(geometry, material);

      // Устанавливаем позицию изображения на заданные координаты
      plane.position.set(4, 0, zCoord);

      // Добавляем плоскость в сцену
      scene.add(plane);

      // Камера
      camera.position.z = 5;

      renderer.render( scene, camera );

      // Функция анимации для рендеринга
      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
      animate();
  }
}

function printElement(width, height, xCoord, yCoord, path) {
  // Загружаем текстуру (картинку)
  const textureLoader = new THREE.TextureLoader();
  let texture = textureLoader.load(path);  // Укажите путь к вашему изображению

  // Создаем плоскость, на которую наложим текстуру
  const geometry = new THREE.PlaneGeometry(width, height);  // Размер плоскости
  const material = new THREE.MeshBasicMaterial({ map: texture });
  const plane = new THREE.Mesh(geometry, material);

  // Устанавливаем позицию изображения на заданные координаты
  plane.position.set(xCoord, yCoord, zCoord);

  // Добавляем плоскость в сцену
  scene.add(plane);

  // Камера
  camera.position.z = 5;

  renderer.render( scene, camera );

  // Функция анимации для рендеринга
  function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
  }
  animate();
}

function testTurbine4(){
    // Загрузчик текстур
    const textureLoader = new THREE.TextureLoader();

    // Массив для хранения текстур
    const textures = [];
    for (let i = 202; i <= 210; i++) { // Предположим, у вас 10 текстур
      const texture = textureLoader.load(`static/turbine frames/Анимация турбины_${i}.jpg`);
      textures.push(texture);
    }

    // Создаем плоскость с начальной текстурой
    const geometry = new THREE.PlaneGeometry(1, 1);
    const material = new THREE.MeshBasicMaterial({ map: textures[0] });
    const plane = new THREE.Mesh(geometry, material);
    plane.position.set(4, 0, zCoord);
    scene.add(plane);

    // Позиционируем камеру
    camera.position.z = 5;

    // Индекс текущей текстуры
    let currentTextureIndex = 0;

    // Функция анимации
    function animate() {
      if (!aesStatus.isWorking) return; // Останавливаем анимацию, если условие не выполняется

      requestAnimationFrame(animate);

      // Меняем текстуру каждые 100 мс
      setTimeout(() => {
        currentTextureIndex = (currentTextureIndex + 1) % textures.length; // Переход к следующей текстуре
        material.map = textures[currentTextureIndex]; // Применяем новую текстуру
        material.needsUpdate = true; // Обновляем материал
      }, 1000);

      renderer.render(scene, camera);
    }

    // Запускаем анимацию
    animate();

    // Пример условия для остановки анимации
    // setTimeout(() => {
    //   isAnimating = false; // Останавливаем анимацию через 10 секунд
    //   console.log("Анимация остановлена");
    // }, 10000); // 10 секунд
}

// function animateWork(){
//     // Загрузчик текстур
//     const textureLoader = new THREE.TextureLoader();
//
//     // Массив для хранения текстур
//     const textures = [];
//     for (let i = 1; i <= 3; i++) {
//       const texture = textureLoader.load(`static/accidents_vver/Анимация запуска ${i}.png`);
//       textures.push(texture);
//     }
//
//     // Создаем плоскость с начальной текстурой
//     const geometry = new THREE.PlaneGeometry(3, 7);
//     const material = new THREE.MeshBasicMaterial({ map: textures[0] });
//     const plane = new THREE.Mesh(geometry, material);
//     plane.position.set(-2, 0.2, zCoord);
//     scene.add(plane);
//
//     // Позиционируем камеру
//     camera.position.z = 5;
//
//     // Индекс текущей текстуры
//     let currentTextureIndex = 0;
//
//     // Условие для анимации
//     let isAnimating = true;
//
//     // Функция анимации
//     function animate() {
//       if (!isAnimating) return; // Останавливаем анимацию, если условие не выполняется
//
//       requestAnimationFrame(animate);
//
//       // Меняем текстуру каждые ?? мс
//       setTimeout(() => {
//         currentTextureIndex = (currentTextureIndex + 1) % textures.length; // Переход к следующей текстуре
//         material.map = textures[currentTextureIndex]; // Применяем новую текстуру
//         material.needsUpdate = true; // Обновляем материал
//       }, 5000);
//
//       renderer.render(scene, camera);
//     }
//
//     // Запускаем анимацию
//     animate();
//
//     // Пример условия для остановки анимации
//     setTimeout(() => {
//       isAnimating = false; // Останавливаем анимацию через ?? секунд
//       console.log("Анимация остановлена");
//     }, 10000); // ?? миллисекунд
// }
// Анимация запуска внутри реактора ОБЛАСТЬ СО ВСЕМИ СБ
function animateWork() {
    const textureLoader = new THREE.TextureLoader();
    const textures = [];
    const texturePromises = [];

    // Асинхронная загрузка текстур
    for (let i = 1; i <= 3; i++) {
        texturePromises.push(new Promise(resolve => {
            textureLoader.load(
                `static/accidents_vver/Анимация запуска ${i}.png`,
                texture => {
                    textures.push(texture);
                    resolve();
                },
                undefined,
                error => console.error('Error loading texture:', error)
            );
        }));
    }

    Promise.all(texturePromises).then(() => {
        if (textures.length === 0) return;

        const geometry = new THREE.PlaneGeometry(3, 7);
        const material = new THREE.MeshBasicMaterial({
            map: textures[0],
            transparent: true
        });
        const plane = new THREE.Mesh(geometry, material);
        plane.position.set(-2, 0.2, zCoord);
        scene.add(plane);

        camera.position.z = 5;

        let currentTextureIndex = 0;
        let lastChangeTime = 0;
        const frameInterval = 500; // ?? секунд между кадрами
        let animationId;

        function animate(timestamp) {
            if (!aesStatus.isWorking) {
                return;
            }

            animationId = requestAnimationFrame(animate);

            // Первый кадр - инициализация времени
            if (lastChangeTime === 0) lastChangeTime = timestamp;

            // Проверяем интервал между кадрами
            const elapsed = timestamp - lastChangeTime;

            if (elapsed >= frameInterval) {
                lastChangeTime = timestamp;
                currentTextureIndex = (currentTextureIndex + 1) % textures.length;
                material.map = textures[currentTextureIndex];
                material.needsUpdate = true;
            }

            renderer.render(scene, camera);
        }

        // Запуск анимации
        animationId = requestAnimationFrame(animate);

        // Остановка через 10 секунд
        setTimeout(() => {
            cancelAnimationFrame(animationId);
            scene.remove(plane);
            geometry.dispose();
            material.dispose();
            textures.forEach(t => t.dispose());
            console.log("Анимация завершена");
        }, 100000);
    });
}

function animateReactorWorking(){
    // Загрузчик текстур
    const textureLoader = new THREE.TextureLoader();

    // Массив для хранения текстур
    const textures = [];
    for (let i = 1; i <= 3; i++) {
      const texture = textureLoader.load(`static/accidents_vver/Анимация запуска реактора ${i}.png`);
      textures.push(texture);
    }

    // Создаем плоскость с начальной текстурой
    const geometry = new THREE.PlaneGeometry(0.75, 4);
    const material = new THREE.MeshBasicMaterial({ map: textures[0] });
    const plane = new THREE.Mesh(geometry, material);
    plane.position.set(reactor_xCoord, reactor_yCoord, zCoord);
    scene.add(plane);

    // Позиционируем камеру
    camera.position.z = 5;

    // Индекс текущей текстуры
    let currentTextureIndex = 0;

    // Функция анимации
    function animate() {
      if (!aesStatus.isWorking) return; // Останавливаем анимацию, если условие не выполняется

      requestAnimationFrame(animate);

      // Меняем текстуру каждые 100 мс
      setTimeout(() => {
        currentTextureIndex = (currentTextureIndex + 1) % textures.length; // Переход к следующей текстуре
        material.map = textures[currentTextureIndex]; // Применяем новую текстуру
        material.needsUpdate = true; // Обновляем материал
      }, 1000);

      renderer.render(scene, camera);
    }

    // Запускаем анимацию
    animate();

    // Пример условия для остановки анимации
    // setTimeout(() => {
    //   isAnimating = false; // Останавливаем анимацию через 10 секунд
    //   console.log("Анимация остановлена");
    // }, 10000); // 10 секунд
}

function testOneAnimation() {
    // Инициализация сцены, камеры и рендерера
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Параметры анимации
    const params = {
      position: new THREE.Vector3(0, 0, 0), // Координаты области
      width: 4,                            // Ширина области
      height: 3,                           // Высота области
      frameDelay: 500,                     // Задержка между кадрами (мс)
      framePaths: [                         // Пути к файлам кадров
        '/static/accidents_vver/Анимация запуска реактора 1.png',
        '/static/accidents_vver/Анимация запуска реактора 2.png',
        '/static/accidents_vver/Анимация запуска реактора 3.png'
        // ... добавьте пути к своим кадрам
      ]
    };

    let textures = []; // Массив для хранения загруженных текстур
    let animationInterval = null; // Ссылка на интервал анимации

    // Загрузка текстур
    new THREE.TextureLoader().load(
      params.framePaths,
      (loadedTextures) => {
        textures = loadedTextures;
        initAnimation();
      }
    );

    function initAnimation() {
      // Создание плоскости для отображения кадров
      const geometry = new THREE.PlaneGeometry(params.width, params.height);
      const material = new THREE.MeshBasicMaterial({
        map: textures[0],
        transparent: true
      });
      const mesh = new THREE.Mesh(geometry, material);
      mesh.position.copy(params.position);
      scene.add(mesh);

      // Настройка камеры
      camera.position.z = 5;

      // Переменные анимации
      let currentFrame = 0;

      // Функция обновления кадра
      function updateFrame() {
        currentFrame++;

        if (currentFrame >= textures.length) {
          stopAnimation();
          return;
        }

        material.map = textures[currentFrame];
        material.needsUpdate = true;
      }

      // Запуск анимации
      function startAnimation() {
        animationInterval = setInterval(updateFrame, params.frameDelay);
      }

      // Остановка анимации
      function stopAnimation() {
        clearInterval(animationInterval);
        animationInterval = null;
      }

      // Запуск анимации
      startAnimation();

      // Цикл рендеринга
      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
      animate();
    }
}

document.getElementById('loadTvel').addEventListener('click', function() {
  loadTvel();
});
document.getElementById('tvsBtn').addEventListener('click', function() {
  printTVS();
});
document.getElementById('reactorBtn').addEventListener('click', function() {
  printReactor();
});
document.getElementById('pgBtn').addEventListener('click', function() {
  printPG();
});
document.getElementById('btnTeplo').addEventListener('click', function() {
    if (aesStatus.isTeploTurn()) {
        let is_gzn = 0;
        try {
            is_gzn = document.querySelector('input[name="teplo"]:checked').value;
        }
        catch(exceptionVar) {
            is_gzn = 0;
        }

        let is_pit_nasos = 0;
        try {
            is_pit_nasos = document.querySelector('input[name="teplo2"]:checked').value;
        }
        catch(exceptionVar) {
            is_pit_nasos = 0;
        }

        let is_elmag = 0;
        try {
            is_elmag = document.querySelector('input[name="teplo3"]:checked').value;
        }
        catch(exceptionVar) {
            is_elmag = 0;
        }

        let is_turbine = 0;
        try {
            is_turbine = document.querySelector('input[name="teplo4"]:checked').value;
        }
        catch(exceptionVar) {
            is_turbine = 0;
        }

        let is_condensator = 0;
        try {
            is_condensator = document.querySelector('input[name="teplo5"]:checked').value;
        }
        catch(exceptionVar) {
            is_condensator = 0;
        }
        // console.log(is_gzn, is_pit_nasos, is_elmag, is_turbine, is_condensator);
        if (
            (is_elmag == 0) &&
            (is_gzn == 'tepl_gzn' && is_pit_nasos == 'tepl_nasos' && is_turbine == 'tepl_turbine' && is_condensator == 'tepl_cond')
        )
        {
            try {
                printGZN();
            } catch (exceptionVar) {}
            try {
                printPitNasos();
            } catch (exceptionVar) {}
            try {
                printTurbine();
            } catch (exceptionVar) {}
            try {
                printCondensator();
            } catch (exceptionVar) {}

            aesStatus.activateSystem('isTeplo');

            aesData.teplo.setProperties(
                'gzn', document.querySelector('input[name="teplo"]:checked').value,
                'pitNasos', document.querySelector('input[name="teplo2"]:checked').value,
                'elmagNasos', document.querySelector('input[name="teplo3"]:checked')?.value ?? 0,
                'turbine', document.querySelector('input[name="teplo4"]:checked').value,
                'condensator', document.querySelector('input[name="teplo5"]:checked').value
            );
            console.log(
                'Подключена теплотехника:',
                'ГЦН', aesData.teplo.gzn, ';',
                'Пит. насос', aesData.teplo.pitNasos, ';',
                'Электромаг. насос', aesData.teplo.elmagNasos, ';',
                'Турбина', aesData.teplo.turbine, ';',
                'Конденсатор', aesData.teplo.condensator
            )
        }
        else {
            errorAlert('Неправильный набор теплотехники для этой установки.')
        }
    } else {
        errorAlert('Сейчас не время подключать теплотехнику. Либо она уже есть, либо сперва сконструируйте основное оборудование (реактор и его внутренности, парогенератор).')
    }
});
document.getElementById('btnRadBez').addEventListener('click', function() {
  printRadBez();
});
document.getElementById('btnSB').addEventListener('click', function() {
    if (aesStatus.isSBTurn()) {
        let is_germo = 0;
        try {
            is_germo = document.querySelector('input[name="sb_1"]:checked').value;
        }
        catch(exceptionVar) {
            is_germo = 0;
        }

        let is_suz = 0;
        try {
            is_suz = document.querySelector('input[name="sb_2"]:checked').value;
        }
        catch(exceptionVar) {
            is_suz = 0;
        }

        let is_ge = 0;
        try {
            is_ge = document.querySelector('input[name="sb_3"]:checked').value;
        }
        catch(exceptionVar) {
            is_ge = 0;
        }

        let is_lovushka = 0;
        try {
            is_lovushka = document.querySelector('input[name="sb_4"]:checked').value;
        }
        catch(exceptionVar) {
            is_lovushka = 0;
        }

        let is_sprink = 0;
        try {
            is_sprink = document.querySelector('input[name="sb_5"]:checked').value;
        }
        catch(exceptionVar) {
            is_sprink = 0;
        }

        let is_sliv = 0;
        try {
            is_sliv = document.querySelector('input[name="sb_6"]:checked').value;
        }
        catch(exceptionVar) {
            is_sliv = 0;
        }

        if (is_sliv == 0 && is_suz !== 0) {
            if (is_germo !== 0) {
                printElement(3, 6.5, -2, 0.5, 'static/vver/germoobolochka.png');
            }

            if (is_lovushka !== 0) {
                printElement(1, 1, -2, -3, 'static/vver/lovushka_empty.png');
            }

            if (is_ge !== 0) {
                printElement(0.3, 2.5, -1.2, 1.5, 'static/vver/gidroemkost.png');
            }

            if (is_sprink !== 0) {
                printElement(1, 0.2, -2, 3, 'static/vver/sprinkler.png');
            }

            aesStatus.activateSystem('isSB');

            aesData.sb.setProperties(
                'germo', document.querySelector('input[name="sb_1"]:checked')?.value ?? 0,
                'suz', document.querySelector('input[name="sb_2"]:checked')?.value ?? 0,
                'ge', document.querySelector('input[name="sb_3"]:checked')?.value ?? 0,
                'lovushka', document.querySelector('input[name="sb_4"]:checked')?.value ?? 0,
                'sprinkler', document.querySelector('input[name="sb_5"]:checked')?.value ?? 0,
                'sliv', document.querySelector('input[name="sb_6"]:checked')?.value ?? 0
            );
            console.log(
                'Спроектированы системы безопасности:',
                'гермооболочка', aesData.sb.germo, ';',
                'СУЗ и АЗ', aesData.sb.suz, ';',
                'гидроёмкости', aesData.sb.ge, ';',
                'ловушка', aesData.sb.lovushka, ';',
                'спринклерная система', aesData.sb.sprinkler, ';',
                'аварийный слив', aesData.sb.sliv
            )

            // строим реактор поверх систем безопасности
            // printElement(0.75, 4, reactor_xCoord, reactor_yCoord, 'static/vver/reactor_vver.jpg');
            printReactor(true);
        } else {
            errorAlert('Грубая ошибка в системах безопасности. Возможно, не хватает СУЗ или стоит убрать слив.')
        }
    } else {
        errorAlert('Сейчас не время проектировать системы безопасности. Возможно, вы их уже сделали. Или не хватает оборудования I и II контура.')
    }
});
document.getElementById('Start').addEventListener('click', function() {
    // раскомментировать, чтобы связать запуск с логикой конструирования
    if (aesStatus.isReadyToWork()) {
        aesStatus.isWorking = true;
       // animateWork();
       testTurbine4();
       animateReactorWorking();
    } else {
        errorAlert('АЭС не готова к запуску. Сначала завершите конструирование.');
    }

});
document.getElementById('test').addEventListener('click', function() {
    greenAlert('Тест')
});
document.getElementById('Stop').addEventListener('click', function() {
    aesStatus.isWorking = false;
    printElement(1, 1, 4, 0, '/static/vver/turbine.jpg');
    printElement(0.75, 4, reactor_xCoord, reactor_yCoord, '/static/vver/reactor_vver.jpg');
    // printReactor(true);
});

document.getElementById('debrise').addEventListener('click', function() {
    if (aesData.isADF()) {
        greenAlert('Успех! Посторонние предметы не попали в активную зону благодаря антидебризным фильтрам.')
    }
    else {
        printElement(reactorGeo.width, reactorGeo.height, reactorGeo.x, reactorGeo.y, 'static/accidents_vver/reactor_opened.png');
        printElement(peregruzGeo.width, peregruzGeo.height, peregruzGeo.x, peregruzGeo.y, 'static/accidents_vver/перегрузочная машина.png');
        yellowAlert('Из-за отсутсвия АДФ посторонние предметы в I контуре попали в активную зону и вызвали коррозию. Это привело к необходимости остановить реактор и заменить повреждённые ТВС. Это нанесло экономический ущерб.')
    }

});
</script>
